

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>hdf5preparation &mdash; pysmFISH 0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="pysmFISH 0 documentation" href="../../index.html"/>
        <link rel="up" title="Stitching API" href="index.html"/>
        <link rel="next" title="hybregistration" href="hybregistration_ref.html"/>
        <link rel="prev" title="Global Optimization" href="GlobalOptimization_ref.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pysmFISH
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to pysmFISH!</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cluster/index.html">Cluster setup</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../filtering_ref.html">filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../counting_ref.html">counting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dots_calling_ref.html">dots_calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dots_coords_calculations_ref.html">dots_coords_calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hdf5_utils_ref.html">hdf5_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io_ref.html">io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object_based_segmentation_ref.html">object_based_segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils_ref.html">utils</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Stitching API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="GlobalOptimization_ref.html">Global Optimization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">hdf5preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="hybregistration_ref.html">hybregistration</a></li>
<li class="toctree-l3"><a class="reference internal" href="inout_ref.html">inout</a></li>
<li class="toctree-l3"><a class="reference internal" href="MicroscopeData_ref.html">MicroscopeData</a></li>
<li class="toctree-l3"><a class="reference internal" href="pairwisehelper_ref.html">pairwisehelper</a></li>
<li class="toctree-l3"><a class="reference internal" href="pairwisesingle_ref.html">pairwisesingle</a></li>
<li class="toctree-l3"><a class="reference internal" href="stitching_ref.html">stitching</a></li>
<li class="toctree-l3"><a class="reference internal" href="tilejoining_ref.html">tilejoining</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pipeline/index.html">Processing pipeline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license/index.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../citing/index.html">Author and citations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ind_tables/index.html">Indices and Tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pysmFISH</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API</a> &raquo;</li>
        
          <li><a href="index.html">Stitching API</a> &raquo;</li>
        
      <li>hdf5preparation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/API/stitching/hdf5preparation_ref.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-pysmFISH.stitching_package.hdf5preparation">
<span id="hdf5preparation"></span><h1>hdf5preparation<a class="headerlink" href="#module-pysmFISH.stitching_package.hdf5preparation" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="pysmFISH.stitching_package.hdf5preparation.create_structures_hdf5_files">
<code class="descclassname">pysmFISH.stitching_package.hdf5preparation.</code><code class="descname">create_structures_hdf5_files</code><span class="sig-paren">(</span><em>stitching_file</em>, <em>joining</em>, <em>nr_pixels</em>, <em>z_size</em>, <em>hyb_nr</em>, <em>gene</em>, <em>ubyte=True</em>, <em>blend='non linear'</em>, <em>reg_name=''</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pysmFISH/stitching_package/hdf5preparation.html#create_structures_hdf5_files"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pysmFISH.stitching_package.hdf5preparation.create_structures_hdf5_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes an HDF5 file handle and creates the necessary structures.</p>
<blockquote>
<div><p>Creates groups and data sets, when the groups or data sets already
exists, they are kept as they are, as long as the data sets have
the right size and data type. Incompatible data sets will be
overwritten.
Stitching file has the following structure:</p>
<p>__________________Groups____________|___Data sets____</p>
<dl class="docutils">
<dt>gene1:</dt>
<dd><dl class="first last docutils">
<dt>StitchedImage:</dt>
<dd>final_image
final_image_ubyte
blending_mask
temp_mask</dd>
<dt>StitchingTempTiles:</dt>
<dd><dl class="first last docutils">
<dt>blended_tiles:</dt>
<dd>0
1
.
.
n</dd>
<dt>ubytes:</dt>
<dd>0
1
.
.
n</dd>
<dt>temp_masks:</dt>
<dd>0
1
.
.
n</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>gene2: …</p>
<blockquote>
<div><dl class="docutils">
<dt>stitching_file: pointer</dt>
<dd>HDF5 file handle. The file where the stitched images will be saved.</dd>
<dt>joining: dict</dt>
<dd>Dictionary containing keys ‘corner_list  and ‘final_image_shape’. 
Corner_list is a list of list, each list is a pair of an image number
(int) and it’s coordinates (numpy array containing floats).
Final_image_shape is a tuple of size 2 or 3 depending on the number of 
dimensions and contains ints.</dd>
<dt>nr_pixels: int</dt>
<dd>Height and length of the tile in pixels, tile is assumed to be square.</dd>
<dt>z_size: int </dt>
<dd>The number of layers in one tile (size of the z-axis). 
Should be 1 or None if the tile is 2D.</dd>
<dt>hyb_nr: int </dt>
<dd>The number of the hybridization we are stitching. 
This will be used to place the data in the right group in stitching_file.</dd>
<dt>gene: str</dt>
<dd>The name of the gene we are stitching.This will be used to place the
data in the right group in stitching_file.</dd>
<dt>ubyte: bool </dt>
<dd>We need to create a data set for the ubyte image when True.
Otherwise we only need to create a data set for the high resolution image.</dd>
<dt>blend: str </dt>
<dd>When ‘non linear’ or ‘linear’, blending will be applied, so we will 
need to create the structures necessary for saving the blended tiles. When
it has another value or is None no blending at all will be applied, 
so we can skip this. This variable also determines to return value of
linear_blending.</dd>
<dt>reg_name: str </dt>
<dd>A name that will be used to create a second StitchedImage group for 
an image that is registered to be aligned with the other hybridizations. 
warp_name will be attached to the end of the group name, which is
StitchedImage.</dd>
</dl>
<dl class="docutils">
<dt>stitched_group: pointer</dt>
<dd>HDF5 reference to the group where the final will be.</dd>
<dt>temp_group: pointer</dt>
<dd>HDF5 reference to the group where the blended tiles will be saved.</dd>
<dt>linear_blending: bool</dt>
<dd>When True later blending should be linear and when False, blending
should be non-linear.</dd>
<dt>ubyte: bool</dt>
<dd>The ubyte image should be saved when True. Otherwise only the high
resolution image should be saved.</dd>
<dt>blend: str </dt>
<dd>When ‘non linear’ or ‘linear’, blending should be applied. When
it has another value or is None no blending at all will be applied.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pysmFISH.stitching_package.hdf5preparation.create_structures_hdf5_stitched_ref_gene_file_npy">
<code class="descclassname">pysmFISH.stitching_package.hdf5preparation.</code><code class="descname">create_structures_hdf5_stitched_ref_gene_file_npy</code><span class="sig-paren">(</span><em>stitching_file</em>, <em>joining</em>, <em>nr_pixels</em>, <em>reference_gene</em>, <em>blend='non linear'</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pysmFISH/stitching_package/hdf5preparation.html#create_structures_hdf5_stitched_ref_gene_file_npy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pysmFISH.stitching_package.hdf5preparation.create_structures_hdf5_stitched_ref_gene_file_npy" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes an HDF5 file handle and creates the necessary structures.</p>
<p>Modification of create_structures_hdf5_files to work with .npy list of
files</p>
<p>Creates groups and data sets, when the groups or data sets already
exists, they are kept as they are, as long as the data sets have
the right size and data type. Incompatible data sets will be
overwritten.
Stitching file has the following structure:</p>
<p>__________________Groups____________|___Data sets____</p>
<dl class="docutils">
<dt>gene_stitched:</dt>
<dd><dl class="first last docutils">
<dt>StitchedImage:</dt>
<dd>final_image
blending_mask</dd>
</dl>
</dd>
</dl>
<dl class="docutils">
<dt>stitching_file: pointer</dt>
<dd>HDF5 file handle. The file where the stitched images will be saved.</dd>
<dt>joining: dict </dt>
<dd>Dictionary containing keys ‘corner_list  and ‘final_image_shape’. 
Corner_list is a list of list, each list is a pair of an image number
(int) and it’s coordinates (numpy array containing floats).
Final_image_shape is a tuple of size 2 or 3
depending on the number of dimensions and contains ints.</dd>
<dt>nr_pixels: int </dt>
<dd>Height and length of the tile in pixels, tile is assumed to be square.</dd>
<dt>reference_gene: str </dt>
<dd><blockquote class="first">
<div>The name of the gene we are stitching.This will be used to place the
data in the right group in stitching_file.</div></blockquote>
<dl class="last docutils">
<dt>blend: str</dt>
<dd>When ‘non linear’ or ‘linear’,blending will be applied,
so we will need to create the structures
necessary for saving the blended tiles. When
it has another value or is None no blending at
all will be applied, so we can skip this.
This variable also determines to return value of
linear_blending.</dd>
</dl>
</dd>
</dl>
<dl class="docutils">
<dt>stitched_group: pointer</dt>
<dd>HDF5 reference to the group where the final will be.</dd>
<dt>linear_blending: bool</dt>
<dd>When True later blending should be linear and when False, blending
should be non-linear.</dd>
<dt>blend: str </dt>
<dd>When ‘non linear’ or ‘linear’, blending should be applied. When
it has another value or is None no blending at
all will be applied.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pysmFISH.stitching_package.hdf5preparation.divide_final_image">
<code class="descclassname">pysmFISH.stitching_package.hdf5preparation.</code><code class="descname">divide_final_image</code><span class="sig-paren">(</span><em>im_shape</em>, <em>nr_blocks</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pysmFISH/stitching_package/hdf5preparation.html#divide_final_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pysmFISH.stitching_package.hdf5preparation.divide_final_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Divide the image in rows if it is too large to be filled at once.</p>
<p>The parallel HDF5 implementation cannot handle images larger
than 2GB. Therefore this function can divide the rows of the image
over nr_blocks to be filled by separate cores.</p>
<dl class="docutils">
<dt>im_shape: tuple</dt>
<dd>Shape (y, x) of the image to be filled.</dd>
<dt>nr_blocks: int</dt>
<dd>The number of block to divide the image in,
typically this will be the number of available cores.</dd>
</dl>
<dl class="docutils">
<dt>y_corners: list</dt>
<dd>List of numpy ints (numpy.int64). The y-corners of all the blocks.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pysmFISH.stitching_package.hdf5preparation.fill_hdf5_MPI">
<code class="descclassname">pysmFISH.stitching_package.hdf5preparation.</code><code class="descname">fill_hdf5_MPI</code><span class="sig-paren">(</span><em>y_corners</em>, <em>ind</em>, <em>im_shape</em>, <em>im_file</em>, <em>ubyte</em>, <em>blend</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pysmFISH/stitching_package/hdf5preparation.html#fill_hdf5_MPI"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pysmFISH.stitching_package.hdf5preparation.fill_hdf5_MPI" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill the data sets in the hdf5 file with zeros, block by block.</p>
<p>The parallel HDF5 implementation cannot handle images larger
than 2GB. Therefore this function only fills the part of the
image from the indexing value found in y_corners[ind] up to
y_corners[ind + 1].</p>
<dl class="docutils">
<dt>y_corners: list</dt>
<dd>List of numpy ints (numpy.int64). The y-corners of all the blocks.</dd>
<dt>ind <span class="classifier-delimiter">:</span> <span class="classifier">int </span></dt>
<dd>The index of the corner in y_corners</dd>
<dt>im_shape: tuple</dt>
<dd>Shape of the final image.</dd>
<dt>im_file: pointer </dt>
<dd>HDF5 file handle or group reference. The file or
group with the datasets that need to be filled.</dd>
<dt>ubyte: bool</dt>
<dd>Ubyte image is filled if True</dd>
<dt>blend: str </dt>
<dd>If this is None datasets needed for blending
are left empty, for all other values they are filled.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pysmFISH.stitching_package.hdf5preparation.fill_hdf5_files">
<code class="descclassname">pysmFISH.stitching_package.hdf5preparation.</code><code class="descname">fill_hdf5_files</code><span class="sig-paren">(</span><em>im_file</em>, <em>joining</em>, <em>nr_pixels</em>, <em>ubyte</em>, <em>blend</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pysmFISH/stitching_package/hdf5preparation.html#fill_hdf5_files"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pysmFISH.stitching_package.hdf5preparation.fill_hdf5_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill the data sets in the hdf5 file with zeros or random data.</p>
<dl class="docutils">
<dt>im_file: pointer</dt>
<dd>HDF5 reference. Reference to the StitchedImage
group or any group or file that contains final_image
and optionally final_image_ubyte, blending_mask and
temp_mask.</dd>
<dt>joining: dictionary </dt>
<dd>Containing the key final_image_shape.
Final_image_shape is a tuple of size 2 or 3 depending on
the number of dimensions and contains ints.</dd>
<dt>nr_pixels: int</dt>
<dd>Height and length of the tile in pixels, tile is assumed to be square.</dd>
<dt>ubyte: bool</dt>
<dd>The ubyte image will be filled when True.
Otherwise only the high resolution image will be saved.</dd>
<dt>blend: str </dt>
<dd>When blend is not None, blending_mask and temp_mask will be filled.</dd>
</dl>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hybregistration_ref.html" class="btn btn-neutral float-right" title="hybregistration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="GlobalOptimization_ref.html" class="btn btn-neutral" title="Global Optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, simone codeluppi.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>